<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQLForensic — Dependency Graph — {{ report.database }}</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>{{ css }}</style>
    <style>
        body { display: flex; flex-direction: column; height: 100vh; }
        .container { flex: 1; display: flex; flex-direction: column; padding: 1rem 2rem; }
        #graph-container { flex: 1; min-height: 0; }
    </style>
</head>
<body>
<div class="container">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:1rem">
        <div>
            <h1 style="font-size:1.5rem;font-weight:800;background:linear-gradient(135deg,#3b82f6,#8b5cf6);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;">SQLForensic</h1>
            <div style="color:var(--text-muted);font-size:0.8rem">{{ report.database }} &middot; Dependency Graph &middot; {{ generated_at }}</div>
        </div>
        <div class="graph-controls" style="margin:0">
            <select onchange="filterGraph(this.value)">
                <option value="all">All Objects</option>
                <option value="table">Tables</option>
                <option value="procedure">Procedures</option>
                <option value="view">Views</option>
            </select>
            <button onclick="resetZoom()">Reset</button>
        </div>
    </div>

    <div id="graph-container"></div>

    <div style="display:flex;justify-content:space-between;align-items:start;gap:1rem;margin-top:0.75rem">
        <div class="graph-legend">
            <div class="legend-item"><div class="legend-dot" style="background:#3b82f6"></div>Table</div>
            <div class="legend-item"><div class="legend-dot" style="background:#8b5cf6"></div>Procedure</div>
            <div class="legend-item"><div class="legend-dot" style="background:#06b6d4"></div>View</div>
            <div class="legend-item"><span style="border-bottom:2px solid #3b82f6;width:20px;display:inline-block"></span>&nbsp;FK</div>
            <div class="legend-item"><span style="border-bottom:2px dashed #475569;width:20px;display:inline-block"></span>&nbsp;Call</div>
        </div>
        <div id="node-detail" style="padding:0.75rem 1rem;background:var(--bg-card);border-radius:var(--radius);border:1px solid var(--border);font-size:0.8rem;color:var(--text-secondary);min-width:200px">
            Click a node for details
        </div>
    </div>
</div>

<script>
{{ graph_js }}
try {
    var data = {{ graph_data|safe }};
    initGraph('graph-container', data);
} catch(e) { console.error('Graph init error:', e); }
</script>
</body>
</html>
