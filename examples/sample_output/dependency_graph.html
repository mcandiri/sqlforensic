<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQLForensic — Dependency Graph — SchoolDB</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
:root{--bg-primary:#0f172a;--bg-secondary:#1e293b;--bg-card:#1e293b;--bg-hover:#334155;--text-primary:#f1f5f9;--text-secondary:#94a3b8;--text-muted:#64748b;--accent:#3b82f6;--accent-glow:rgba(59,130,246,0.3);--green:#22c55e;--yellow:#eab308;--orange:#f97316;--red:#ef4444;--border:#334155;--radius:12px}*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Inter',-apple-system,BlinkMacSystemFont,sans-serif;background:var(--bg-primary);color:var(--text-primary);display:flex;flex-direction:column;height:100vh}.container{flex:1;display:flex;flex-direction:column;padding:1rem 2rem}#graph-container{flex:1;min-height:0;background:var(--bg-secondary);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;position:relative}#graph-container svg{width:100%;height:100%}.graph-controls{display:flex;gap:.5rem;margin-bottom:1rem;align-items:center}.graph-controls select,.graph-controls button{padding:.5rem .875rem;background:var(--bg-secondary);border:1px solid var(--border);border-radius:8px;color:var(--text-primary);font-size:.8rem;cursor:pointer}.graph-controls button:hover{border-color:var(--accent)}.graph-legend{display:flex;gap:1rem;flex-wrap:wrap}.legend-item{display:flex;align-items:center;gap:.4rem;font-size:.8rem;color:var(--text-secondary)}.legend-dot{width:12px;height:12px;border-radius:50%}.node-tooltip{position:absolute;background:var(--bg-card);border:1px solid var(--accent);border-radius:8px;padding:.75rem 1rem;font-size:.8rem;pointer-events:none;opacity:0;transition:opacity .15s;z-index:100;box-shadow:0 8px 30px rgba(0,0,0,.5);max-width:250px}.node-tooltip.visible{opacity:1}.node-tooltip strong{display:block;margin-bottom:.3rem;color:var(--accent)}.badge{display:inline-block;padding:.2rem .6rem;border-radius:6px;font-size:.7rem;font-weight:600}.badge-low{background:rgba(34,197,94,.15);color:var(--green);border:1px solid rgba(34,197,94,.3)}
    </style>
</head>
<body>
<div class="container">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:1rem">
        <div>
            <h1 style="font-size:1.5rem;font-weight:800;background:linear-gradient(135deg,#3b82f6,#8b5cf6);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text">SQLForensic</h1>
            <div style="color:var(--text-muted);font-size:.8rem">SchoolDB &middot; Dependency Graph &middot; 2026-02-22 14:30:00</div>
        </div>
        <div class="graph-controls" style="margin:0">
            <select onchange="filterGraph(this.value)">
                <option value="all">All Objects</option>
                <option value="table">Tables</option>
                <option value="procedure">Procedures</option>
                <option value="view">Views</option>
            </select>
            <button onclick="resetZoom()">Reset</button>
        </div>
    </div>
    <div id="graph-container"></div>
    <div style="display:flex;justify-content:space-between;align-items:start;gap:1rem;margin-top:.75rem">
        <div class="graph-legend">
            <div class="legend-item"><div class="legend-dot" style="background:#3b82f6"></div>Table</div>
            <div class="legend-item"><div class="legend-dot" style="background:#8b5cf6"></div>Procedure</div>
            <div class="legend-item"><div class="legend-dot" style="background:#06b6d4"></div>View</div>
            <div class="legend-item"><span style="border-bottom:2px solid #3b82f6;width:20px;display:inline-block"></span>&nbsp;FK</div>
            <div class="legend-item"><span style="border-bottom:1px solid #475569;width:20px;display:inline-block"></span>&nbsp;Reference</div>
            <div class="legend-item"><span style="border-bottom:2px dashed #475569;width:20px;display:inline-block"></span>&nbsp;Call</div>
        </div>
        <div id="node-detail" style="padding:.75rem 1rem;background:var(--bg-card);border-radius:var(--radius);border:1px solid var(--border);font-size:.8rem;color:var(--text-secondary);min-width:200px">Click a node for details</div>
    </div>
</div>
<script>
function initGraph(containerId,graphData){var container=document.getElementById(containerId);if(!container||!graphData||!graphData.nodes||!graphData.nodes.length)return;var width=container.clientWidth,height=container.clientHeight;var colorMap={table:'#3b82f6',procedure:'#8b5cf6',view:'#06b6d4',unknown:'#64748b'};var svg=d3.select('#'+containerId).append('svg').attr('viewBox',[0,0,width,height]);var g=svg.append('g');var zoom=d3.zoom().scaleExtent([.1,5]).on('zoom',function(e){g.attr('transform',e.transform)});svg.call(zoom);var tooltip=d3.select('#'+containerId).append('div').attr('class','node-tooltip');var simulation=d3.forceSimulation(graphData.nodes).force('link',d3.forceLink(graphData.links).id(function(d){return d.id}).distance(120)).force('charge',d3.forceManyBody().strength(-400)).force('center',d3.forceCenter(width/2,height/2)).force('collision',d3.forceCollide().radius(35));svg.append('defs').selectAll('marker').data(['fk','ref','call']).join('marker').attr('id',function(d){return'arrow-'+d}).attr('viewBox','0 -5 10 10').attr('refX',25).attr('refY',0).attr('markerWidth',6).attr('markerHeight',6).attr('orient','auto').append('path').attr('fill',function(d){return d==='fk'?'#3b82f6':'#475569'}).attr('d','M0,-5L10,0L0,5');var link=g.append('g').selectAll('line').data(graphData.links).join('line').attr('stroke',function(d){return d.type==='foreign_key'?'#3b82f6':'#475569'}).attr('stroke-opacity',.4).attr('stroke-width',function(d){return d.type==='foreign_key'?2:1}).attr('stroke-dasharray',function(d){return d.type==='calls'?'5,5':null}).attr('marker-end',function(d){if(d.type==='foreign_key')return'url(#arrow-fk)';if(d.type==='calls')return'url(#arrow-call)';return'url(#arrow-ref)'});var node=g.append('g').selectAll('g').data(graphData.nodes).join('g').call(d3.drag().on('start',function(e,d){if(!e.active)simulation.alphaTarget(.3).restart();d.fx=d.x;d.fy=d.y}).on('drag',function(e,d){d.fx=e.x;d.fy=e.y}).on('end',function(e,d){if(!e.active)simulation.alphaTarget(0);d.fx=null;d.fy=null}));node.append('circle').attr('r',function(d){return(d.type==='table'?12:8)+Math.min(d.criticality,15)}).attr('fill',function(d){return colorMap[d.type]||colorMap.unknown}).attr('stroke',function(d){return d.criticality>10?'#ef4444':'#1e293b'}).attr('stroke-width',function(d){return d.criticality>10?2.5:1.5}).attr('opacity',.9);node.append('text').text(function(d){return d.id}).attr('dx',function(d){return(d.type==='table'?16:12)+Math.min(d.criticality,10)}).attr('dy',4).attr('fill','#94a3b8').attr('font-size','11px').attr('font-family','Inter,sans-serif');node.on('mouseover',function(event,d){var connected=new Set();graphData.links.forEach(function(l){var s=typeof l.source==='object'?l.source.id:l.source,t=typeof l.target==='object'?l.target.id:l.target;if(s===d.id)connected.add(t);if(t===d.id)connected.add(s)});connected.add(d.id);node.select('circle').attr('opacity',function(n){return connected.has(n.id)?1:.15});node.select('text').attr('opacity',function(n){return connected.has(n.id)?1:.15});link.attr('stroke-opacity',function(l){var s=typeof l.source==='object'?l.source.id:l.source,t=typeof l.target==='object'?l.target.id:l.target;return(s===d.id||t===d.id)?.8:.05});tooltip.classed('visible',true).html('<strong>'+d.id+'</strong>Type: '+d.type+'<br>Connections: '+d.criticality).style('left',(event.offsetX+15)+'px').style('top',(event.offsetY-10)+'px')}).on('mouseout',function(){node.select('circle').attr('opacity',.9);node.select('text').attr('opacity',1);link.attr('stroke-opacity',.4);tooltip.classed('visible',false)}).on('click',function(event,d){var detail=document.getElementById('node-detail');if(detail){var inc=graphData.links.filter(function(l){return(typeof l.target==='object'?l.target.id:l.target)===d.id}),out=graphData.links.filter(function(l){return(typeof l.source==='object'?l.source.id:l.source)===d.id});detail.innerHTML='<h3 style="color:var(--accent);margin-bottom:0.5rem">'+d.id+'</h3><p><b>Type:</b> '+d.type+'</p><p><b>Incoming:</b> '+inc.length+'</p><p><b>Outgoing:</b> '+out.length+'</p><div style="margin-top:0.5rem">'+inc.map(function(l){var s=typeof l.source==='object'?l.source.id:l.source;return'<span class="badge badge-low" style="margin:2px">'+s+'</span>'}).join('')+'</div>'}});simulation.on('tick',function(){link.attr('x1',function(d){return d.source.x}).attr('y1',function(d){return d.source.y}).attr('x2',function(d){return d.target.x}).attr('y2',function(d){return d.target.y});node.attr('transform',function(d){return'translate('+d.x+','+d.y+')'})});window.filterGraph=function(type){if(type==='all'){node.style('display',null);link.style('display',null)}else{node.style('display',function(d){return d.type===type?null:'none'});link.style('display',function(l){var s=typeof l.source==='object'?l.source:graphData.nodes.find(function(n){return n.id===l.source});var t=typeof l.target==='object'?l.target:graphData.nodes.find(function(n){return n.id===l.target});return(s&&s.type===type)||(t&&t.type===type)?null:'none'})}};window.resetZoom=function(){svg.transition().duration(750).call(zoom.transform,d3.zoomIdentity)}}
var graphData={"nodes":[{"id":"Students","type":"table","criticality":22},{"id":"Teachers","type":"table","criticality":8},{"id":"Courses","type":"table","criticality":18},{"id":"Enrollments","type":"table","criticality":14},{"id":"Grades","type":"table","criticality":9},{"id":"Payments","type":"table","criticality":7},{"id":"Departments","type":"table","criticality":5},{"id":"Classrooms","type":"table","criticality":3},{"id":"Schedules","type":"table","criticality":6},{"id":"Attendance","type":"table","criticality":5},{"id":"Exams","type":"table","criticality":5},{"id":"ExamResults","type":"table","criticality":4},{"id":"Assignments","type":"table","criticality":4},{"id":"Submissions","type":"table","criticality":3},{"id":"Users","type":"table","criticality":11},{"id":"sp_EnrollStudent","type":"procedure","criticality":8},{"id":"sp_GetStudentGrades","type":"procedure","criticality":6},{"id":"sp_ProcessPayments","type":"procedure","criticality":5},{"id":"sp_GenerateTranscript","type":"procedure","criticality":9},{"id":"sp_CalculateGPA","type":"procedure","criticality":5},{"id":"sp_DynamicSearch","type":"procedure","criticality":3},{"id":"sp_UpdateSchedule","type":"procedure","criticality":4},{"id":"sp_AssignTeacher","type":"procedure","criticality":4},{"id":"sp_RecordAttendance","type":"procedure","criticality":3},{"id":"sp_CreateExam","type":"procedure","criticality":3},{"id":"sp_GradeExam","type":"procedure","criticality":4},{"id":"sp_SubmitAssignment","type":"procedure","criticality":3},{"id":"sp_AddStudent","type":"procedure","criticality":2},{"id":"sp_GetCourseRoster","type":"procedure","criticality":3},{"id":"sp_GetPaymentStatus","type":"procedure","criticality":2},{"id":"vw_StudentEnrollments","type":"view","criticality":4},{"id":"vw_CourseGrades","type":"view","criticality":5},{"id":"vw_TeacherSchedule","type":"view","criticality":3},{"id":"vw_AttendanceSummary","type":"view","criticality":3},{"id":"vw_PaymentHistory","type":"view","criticality":3}],"links":[{"source":"Enrollments","target":"Students","type":"foreign_key"},{"source":"Enrollments","target":"Courses","type":"foreign_key"},{"source":"Grades","target":"Students","type":"foreign_key"},{"source":"Grades","target":"Courses","type":"foreign_key"},{"source":"Payments","target":"Students","type":"foreign_key"},{"source":"Students","target":"Departments","type":"foreign_key"},{"source":"Courses","target":"Departments","type":"foreign_key"},{"source":"Courses","target":"Teachers","type":"foreign_key"},{"source":"Schedules","target":"Courses","type":"foreign_key"},{"source":"Schedules","target":"Classrooms","type":"foreign_key"},{"source":"Attendance","target":"Students","type":"foreign_key"},{"source":"Attendance","target":"Schedules","type":"foreign_key"},{"source":"Exams","target":"Courses","type":"foreign_key"},{"source":"ExamResults","target":"Exams","type":"foreign_key"},{"source":"ExamResults","target":"Students","type":"foreign_key"},{"source":"Assignments","target":"Courses","type":"foreign_key"},{"source":"Submissions","target":"Assignments","type":"foreign_key"},{"source":"Submissions","target":"Students","type":"foreign_key"},{"source":"sp_EnrollStudent","target":"Students","type":"references"},{"source":"sp_EnrollStudent","target":"Courses","type":"references"},{"source":"sp_EnrollStudent","target":"Enrollments","type":"references"},{"source":"sp_EnrollStudent","target":"Payments","type":"references"},{"source":"sp_GetStudentGrades","target":"Students","type":"references"},{"source":"sp_GetStudentGrades","target":"Grades","type":"references"},{"source":"sp_GetStudentGrades","target":"Courses","type":"references"},{"source":"sp_GetStudentGrades","target":"Enrollments","type":"references"},{"source":"sp_ProcessPayments","target":"Payments","type":"references"},{"source":"sp_ProcessPayments","target":"Students","type":"references"},{"source":"sp_GenerateTranscript","target":"Students","type":"references"},{"source":"sp_GenerateTranscript","target":"Enrollments","type":"references"},{"source":"sp_GenerateTranscript","target":"Grades","type":"references"},{"source":"sp_GenerateTranscript","target":"Courses","type":"references"},{"source":"sp_GenerateTranscript","target":"ExamResults","type":"references"},{"source":"sp_GenerateTranscript","target":"Submissions","type":"references"},{"source":"sp_GenerateTranscript","target":"Assignments","type":"references"},{"source":"sp_CalculateGPA","target":"Students","type":"references"},{"source":"sp_CalculateGPA","target":"Grades","type":"references"},{"source":"sp_CalculateGPA","target":"Courses","type":"references"},{"source":"sp_DynamicSearch","target":"Students","type":"references"},{"source":"sp_UpdateSchedule","target":"Schedules","type":"references"},{"source":"sp_UpdateSchedule","target":"Classrooms","type":"references"},{"source":"sp_AssignTeacher","target":"Teachers","type":"references"},{"source":"sp_AssignTeacher","target":"Courses","type":"references"},{"source":"sp_RecordAttendance","target":"Attendance","type":"references"},{"source":"sp_RecordAttendance","target":"Schedules","type":"references"},{"source":"sp_CreateExam","target":"Exams","type":"references"},{"source":"sp_CreateExam","target":"Courses","type":"references"},{"source":"sp_GradeExam","target":"ExamResults","type":"references"},{"source":"sp_GradeExam","target":"Exams","type":"references"},{"source":"sp_SubmitAssignment","target":"Submissions","type":"references"},{"source":"sp_SubmitAssignment","target":"Assignments","type":"references"},{"source":"sp_AddStudent","target":"Students","type":"references"},{"source":"sp_GetCourseRoster","target":"Enrollments","type":"references"},{"source":"sp_GetCourseRoster","target":"Students","type":"references"},{"source":"sp_GetPaymentStatus","target":"Payments","type":"references"},{"source":"sp_GenerateTranscript","target":"sp_CalculateGPA","type":"calls"},{"source":"vw_StudentEnrollments","target":"Students","type":"references"},{"source":"vw_StudentEnrollments","target":"Enrollments","type":"references"},{"source":"vw_CourseGrades","target":"Courses","type":"references"},{"source":"vw_CourseGrades","target":"Grades","type":"references"},{"source":"vw_CourseGrades","target":"Students","type":"references"},{"source":"vw_TeacherSchedule","target":"Teachers","type":"references"},{"source":"vw_TeacherSchedule","target":"Schedules","type":"references"},{"source":"vw_AttendanceSummary","target":"Attendance","type":"references"},{"source":"vw_AttendanceSummary","target":"Students","type":"references"},{"source":"vw_PaymentHistory","target":"Payments","type":"references"},{"source":"vw_PaymentHistory","target":"Students","type":"references"}]};
try{initGraph('graph-container',graphData)}catch(e){console.error(e)}
</script>
</body>
</html>
